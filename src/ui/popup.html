<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>YouTube Organizer</title>
    <style>
      body { font-family: system-ui, sans-serif; padding: 12px; width: 320px; }
      button { padding: 8px 10px; margin: 6px 0; width: 100%; }
      input[type=text] { width: 100%; padding: 6px; box-sizing: border-box; }
      small { color: #666; }
      .row { display: flex; gap: 8px; }
      .help { display: block; margin: 6px 0; line-height: 1.35; }
    </style>
  </head>
  <body>
    <h3>YouTube Organizer</h3>

    <section>
      <h4>Status</h4>
      <div id="status"></div>
      <button id="refreshStatus">Refresh Status</button>
      <small class="help">Shows counts using YouTube Data API (requires auth).</small>
    </section>

    <section>
      <h4>Google OAuth Client ID</h4>
      <small class="help">
        키 발급: <a
          href="https://console.cloud.google.com/apis/credentials"
          target="_blank"
          rel="noreferrer"
        >Google Cloud Console → APIs &amp; Services → Credentials</a>
      </small>
      <small class="help">
        권장(이 프로젝트 기준, 공식 가이드 동일): <b>chrome.identity.launchWebAuthFlow</b>를 쓰는 경우
        OAuth 클라이언트를 <b>웹 애플리케이션</b>으로 만들고,
        Authorized redirect URI에 아래 <b>Redirect URI</b> 값을 <u>그대로(한 글자도 변경 없이)</u> 추가하세요.
        <div>※ 공식 Redirect URI 형식: <code>https://&lt;extension-id&gt;.chromiumapp.org/</code></div>
        <div>※ <code>redirect_uri_mismatch</code>는 대부분 여기(URI 불일치/끝 슬래시 차이)에서 발생합니다.</div>
      </small>
      <small class="help">
        대안: OAuth 클라이언트를 <b>Chrome 확장 프로그램</b> 유형으로 만들면 “항목 ID”가 필요한데,
        이 값은 <b>웹스토어 등록 ID가 아니라 확장 프로그램 ID</b>입니다.
        개발 중에도 <code>chrome://extensions</code> → 개발자 모드 → (Load unpacked 후) 표시되는 ID를 그대로 넣으면 됩니다.
      </small>
      <small class="help">
        팀 공유/PC 변경으로 ID가 바뀌는 게 싫다면, 확장을 “Pack”해서 생성된 <code>.pem</code> 키를 유지해
        동일한 확장 ID를 쓰는 방식이 있습니다. 자세한 내용: <a
          href="https://developer.chrome.com/docs/extensions/how-to/integrate/oauth/"
          target="_blank"
          rel="noreferrer"
        >Chrome Extensions OAuth 가이드</a>
      </small>
      <small id="extensionIdHint" class="help"></small>
      <small id="redirectUriHint" class="help"></small>
      <input id="clientId" type="text" placeholder="xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com" />
      <div class="row">
        <button id="saveClientId">Save</button>
        <button id="testAuth">Test Auth</button>
      </div>
      <small>Uses chrome.identity.launchWebAuthFlow (implicit flow)</small>
    </section>

    <section>
      <h4>Subscriptions</h4>
      <small class="help">Export first, then explicitly confirm unsubscribe.</small>
      <div class="row">
        <button id="cleanupSubsCsv">Cleanup (CSV)</button>
        <button id="cleanupSubsJson">Cleanup (JSON)</button>
      </div>
    </section>

    <section>
      <h4>Playlists</h4>
      <button id="listPlaylists">List My Playlists</button>
      <div id="playlists"></div>
    </section>

    <section>
      <h4>Watch Later</h4>
      <button id="clearWatchLater">Clear Watch Later (danger)</button>
      <small class="help">Deletes all items from Watch Later. Requires write scope.</small>
    </section>

    <section>
      <h4>Review & AI</h4>
      <button id="openReview">Open Review Page</button>
      <button id="exportLogs">Export Logs</button>
    </section>

    <script type="module" src="./popup.ts"></script>
  </body>
</html>
